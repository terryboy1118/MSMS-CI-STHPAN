args: Namespace(random_seed=2023, is_finetune=1, is_linear_probe=0, dset_finetune='stock', context_points=512, target_points=1, batch_size=1, num_workers=10, scaler='standard', features='M', market='NYSE', patch_len=12, stride=12, revin=1, ci=1, graph=1, rel_type=8, k=20, n_layers=3, n_heads=16, d_model=128, d_ff=256, dropout=0.2, head_dropout=0.0, n_epochs_finetune=20, lr=0.0001, alpha=2, pretrained_model=None, finetuned_model_id=1, model_type='based_model')
use GPU: 0
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00035938136638046257
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.009779717241014754.
              0       0.015933       0.009780          00:43
Better model found at epoch 1 with valid_loss value: 0.003219871057404412.
              1       0.005431       0.003220          00:43
              2       0.004980       0.003621          00:43
              3       0.005324       0.009026          00:43
Better model found at epoch 4 with valid_loss value: 0.0028830012158742027.
              4       0.003942       0.002883          00:43
Better model found at epoch 5 with valid_loss value: 0.002194964223437839.
              5       0.002501       0.002195          00:43
Better model found at epoch 6 with valid_loss value: 0.001960624068502396.
              6       0.003523       0.001961          00:43
Better model found at epoch 7 with valid_loss value: 0.0018225509732488602.
              7       0.001806       0.001823          00:43
Better model found at epoch 8 with valid_loss value: 0.0016568015728678023.
              8       0.001737       0.001657          00:43
              9       0.001682       0.001676          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
              0       0.001640       0.001699          01:49
              1       0.001549       0.001811          01:49
Better model found at epoch 2 with valid_loss value: 0.0013068002604302905.
              2       0.001457       0.001307          01:49
              3       0.001437       0.001433          01:49
Better model found at epoch 4 with valid_loss value: 0.0010007339574041822.
              4       0.001739       0.001001          01:49
              5       0.001289       0.001369          01:49
              6       0.001262       0.002433          01:49
              7       0.001080       0.001340          01:49
Better model found at epoch 8 with valid_loss value: 0.0009566334386666616.
              8       0.000847       0.000957          01:49
              9       0.000860       0.001120          01:49
Better model found at epoch 10 with valid_loss value: 0.0009353855654360756.
             10       0.000829       0.000935          01:49
Better model found at epoch 11 with valid_loss value: 0.0008668615704491025.
             11       0.000778       0.000867          01:49
             12       0.000713       0.001218          01:49
Better model found at epoch 13 with valid_loss value: 0.000806101021312532.
             13       0.000663       0.000806          01:49
             14       0.000653       0.001072          01:49
             15       0.000641       0.001096          01:49
             16       0.000619       0.001188          01:49
Better model found at epoch 17 with valid_loss value: 0.0007851767161535839.
             17       0.000602       0.000785          01:49
             18       0.000585       0.000853          01:49
             19       0.000577       0.000893          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.00035222221729198423, 'btl5': 0.5625568681061215, 'sharpe5': 1.9502767325458363, 'ndcg_score_top5': 0.9697423512715021}
----------- alpha: 2  itr: 0 Complete! Time:4000-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 5.590810182512223e-05
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.03443274800739591.
              0       0.046701       0.034433          00:43
Better model found at epoch 1 with valid_loss value: 0.015483512764885313.
              1       0.015210       0.015484          00:43
Better model found at epoch 2 with valid_loss value: 0.008411385710277254.
              2       0.007759       0.008411          00:43
Better model found at epoch 3 with valid_loss value: 0.005831550038050091.
              3       0.005223       0.005832          00:43
Better model found at epoch 4 with valid_loss value: 0.004648358102828738.
              4       0.004409       0.004648          00:43
Better model found at epoch 5 with valid_loss value: 0.004050200893765404.
              5       0.003862       0.004050          00:43
Better model found at epoch 6 with valid_loss value: 0.0035428721753377763.
              6       0.003697       0.003543          00:43
              7       0.003469       0.003602          00:43
Better model found at epoch 8 with valid_loss value: 0.003476665606574407.
              8       0.003351       0.003477          00:43
              9       0.003358       0.003485          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0031512069796758983.
              0       0.003317       0.003151          01:49
Better model found at epoch 1 with valid_loss value: 0.0028452236974050127.
              1       0.003056       0.002845          01:49
Better model found at epoch 2 with valid_loss value: 0.0021558422890920487.
              2       0.002816       0.002156          01:49
              3       0.002553       0.003374          01:49
Better model found at epoch 4 with valid_loss value: 0.0017766821242514112.
              4       0.002229       0.001777          01:49
              5       0.002116       0.002188          01:49
              6       0.001898       0.003096          01:49
              7       0.001768       0.001804          01:49
Better model found at epoch 8 with valid_loss value: 0.00144153797910327.
              8       0.001644       0.001442          01:49
              9       0.001576       0.003054          01:49
             10       0.001471       0.001925          01:49
             11       0.001412       0.002564          01:49
             12       0.001342       0.002002          01:49
             13       0.001325       0.001547          01:49
             14       0.001296       0.001756          01:49
             15       0.001246       0.002061          01:49
             16       0.001241       0.002411          01:49
             17       0.001239       0.001825          01:49
             18       0.001222       0.001895          01:49
             19       0.001217       0.002134          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.000988478351005293, 'btl5': 0.49930054649534816, 'sharpe5': 1.5402642902364563, 'ndcg_score_top5': 0.98631461300602}
----------- alpha: 2  itr: 1 Complete! Time:4000-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 4.641588833612777e-05
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.037081771426730685.
              0       0.075755       0.037082          00:43
Better model found at epoch 1 with valid_loss value: 0.01942590872446696.
              1       0.018097       0.019426          00:43
Better model found at epoch 2 with valid_loss value: 0.011142920880090623.
              2       0.010594       0.011143          00:43
Better model found at epoch 3 with valid_loss value: 0.007511701848771837.
              3       0.007071       0.007512          00:43
Better model found at epoch 4 with valid_loss value: 0.005764319783165341.
              4       0.005452       0.005764          00:43
Better model found at epoch 5 with valid_loss value: 0.004384714932668777.
              5       0.004791       0.004385          00:43
Better model found at epoch 6 with valid_loss value: 0.0041957710470472065.
              6       0.004322       0.004196          00:43
Better model found at epoch 7 with valid_loss value: 0.003763226762650505.
              7       0.004104       0.003763          00:43
Better model found at epoch 8 with valid_loss value: 0.003742004670794048.
              8       0.004054       0.003742          00:43
              9       0.003958       0.003921          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
              0       0.003932       0.004107          01:49
Better model found at epoch 1 with valid_loss value: 0.0032435225115882028.
              1       0.003648       0.003244          01:49
Better model found at epoch 2 with valid_loss value: 0.00238928080551208.
              2       0.003292       0.002389          01:49
              3       0.002956       0.002638          01:49
Better model found at epoch 4 with valid_loss value: 0.0022977335112435477.
              4       0.002533       0.002298          01:49
Better model found at epoch 5 with valid_loss value: 0.0015774012084991214.
              5       0.002269       0.001577          01:49
              6       0.002143       0.002034          01:49
Better model found at epoch 7 with valid_loss value: 0.0014614668630418323.
              7       0.001951       0.001461          01:49
              8       0.001852       0.001684          01:49
              9       0.001779       0.001841          01:49
Better model found at epoch 10 with valid_loss value: 0.0012704791530730231.
             10       0.001671       0.001270          01:49
             11       0.001610       0.001650          01:49
             12       0.001534       0.001295          01:49
Better model found at epoch 13 with valid_loss value: 0.0011524783950003367.
             13       0.001505       0.001152          01:49
             14       0.001461       0.001304          01:49
             15       0.001429       0.001293          01:49
             16       0.001422       0.001301          01:49
             17       0.001408       0.001303          01:49
             18       0.001412       0.001367          01:49
             19       0.001383       0.001427          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0004985793393031905, 'btl5': 0.3443648679623321, 'sharpe5': 1.3469255543984053, 'ndcg_score_top5': 0.9820378298345914}
----------- alpha: 2  itr: 2 Complete! Time:4003-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00014174741629268049
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.02056429688892667.
              0       0.050398       0.020564          00:43
Better model found at epoch 1 with valid_loss value: 0.007571902539994981.
              1       0.009370       0.007572          00:43
Better model found at epoch 2 with valid_loss value: 0.00414505884760902.
              2       0.005447       0.004145          00:43
Better model found at epoch 3 with valid_loss value: 0.002904436891041105.
              3       0.003930       0.002904          00:43
              4       0.003461       0.002996          00:43
Better model found at epoch 5 with valid_loss value: 0.002628574532175821.
              5       0.003204       0.002629          00:43
              6       0.002926       0.003247          00:43
Better model found at epoch 7 with valid_loss value: 0.002386615862922063.
              7       0.002812       0.002387          00:43
Better model found at epoch 8 with valid_loss value: 0.002322038487782554.
              8       0.002692       0.002322          00:43
              9       0.002761       0.002549          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.002144662397248404.
              0       0.002604       0.002145          01:49
              1       0.002482       0.002453          01:49
Better model found at epoch 2 with valid_loss value: 0.0016624356309572856.
              2       0.002202       0.001662          01:49
Better model found at epoch 3 with valid_loss value: 0.0016232549198090084.
              3       0.001945       0.001623          01:49
Better model found at epoch 4 with valid_loss value: 0.001612079521966359.
              4       0.001849       0.001612          01:49
Better model found at epoch 5 with valid_loss value: 0.0011580510744972833.
              5       0.001629       0.001158          01:49
              6       0.001562       0.001487          01:49
              7       0.001367       0.001431          01:49
Better model found at epoch 8 with valid_loss value: 0.0009671617594976274.
              8       0.001254       0.000967          01:49
              9       0.001126       0.001367          01:49
Better model found at epoch 10 with valid_loss value: 0.0009264727196996174.
             10       0.001091       0.000926          01:49
             11       0.000998       0.001035          01:49
             12       0.000965       0.001158          01:49
             13       0.000913       0.001166          01:49
Better model found at epoch 14 with valid_loss value: 0.0009033694745056213.
             14       0.000906       0.000903          01:49
             15       0.000866       0.001016          01:49
             16       0.000855       0.001321          01:49
             17       0.000843       0.000936          01:49
             18       0.000833       0.000999          01:49
             19       0.000823       0.001073          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.00046605163528880755, 'btl5': 0.2190414805998009, 'sharpe5': 1.0625499295307828, 'ndcg_score_top5': 0.9638644855908982}
----------- alpha: 2  itr: 3 Complete! Time:4002-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.000298364724028334
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.015118129669673859.
              0       0.021211       0.015118          00:43
Better model found at epoch 1 with valid_loss value: 0.007031990422142876.
              1       0.005590       0.007032          00:43
Better model found at epoch 2 with valid_loss value: 0.007009424860515292.
              2       0.005503       0.007009          00:43
              3       0.004432       0.036368          00:43
              4       0.003299       0.010288          00:43
Better model found at epoch 5 with valid_loss value: 0.0020564522535081895.
              5       0.002836       0.002056          00:43
              6       0.002189       0.002064          00:43
Better model found at epoch 7 with valid_loss value: 0.0018678739193886045.
              7       0.001942       0.001868          00:43
Better model found at epoch 8 with valid_loss value: 0.0017783836949439276.
              8       0.001812       0.001778          00:43
Better model found at epoch 9 with valid_loss value: 0.0017536284904631357.
              9       0.001804       0.001754          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0015033934087980362.
              0       0.001735       0.001503          01:50
Better model found at epoch 1 with valid_loss value: 0.0013041063433601742.
              1       0.001643       0.001304          01:50
Better model found at epoch 2 with valid_loss value: 0.001216339213507516.
              2       0.001732       0.001216          01:49
              3       0.001506       0.002712          01:49
              4       0.001715       0.002010          01:49
              5       0.001414       0.001302          01:49
              6       0.001101       0.001354          01:49
Better model found at epoch 7 with valid_loss value: 0.0011228823236056737.
              7       0.001128       0.001123          01:49
              8       0.000934       0.002426          01:49
              9       0.000915       0.001370          01:49
Better model found at epoch 10 with valid_loss value: 0.0009144744466221522.
             10       0.000816       0.000914          01:49
             11       0.000783       0.001558          01:49
             12       0.000772       0.001087          01:49
Better model found at epoch 13 with valid_loss value: 0.000838871867883773.
             13       0.000689       0.000839          01:49
Better model found at epoch 14 with valid_loss value: 0.000787894581518476.
             14       0.000689       0.000788          01:49
             15       0.000667       0.001126          01:49
             16       0.000633       0.000966          01:49
             17       0.000622       0.000966          01:49
             18       0.000616       0.000998          01:49
             19       0.000606       0.000927          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.00035123972970201993, 'btl5': 0.45668985115369365, 'sharpe5': 1.4790820156575397, 'ndcg_score_top5': 0.9966597775145196}
----------- alpha: 2  itr: 4 Complete! Time:4010-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00020565123083486514
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.011759545121874129.
              0       0.018730       0.011760          00:43
Better model found at epoch 1 with valid_loss value: 0.0038531505399280125.
              1       0.005955       0.003853          00:43
              2       0.004025       0.004095          00:44
              3       0.004105       0.003988          00:43
Better model found at epoch 4 with valid_loss value: 0.003246279935988169.
              4       0.003245       0.003246          00:43
              5       0.002986       0.003311          00:44
Better model found at epoch 6 with valid_loss value: 0.002073252721438332.
              6       0.002865       0.002073          00:43
Better model found at epoch 7 with valid_loss value: 0.0016610052377458602.
              7       0.002023       0.001661          00:43
              8       0.001912       0.001736          00:43
Better model found at epoch 9 with valid_loss value: 0.0016093295481469897.
              9       0.001910       0.001609          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0014529055546200465.
              0       0.001829       0.001453          01:50
              1       0.001732       0.001530          01:49
              2       0.001656       0.001470          01:49
Better model found at epoch 3 with valid_loss value: 0.0012889270271573747.
              3       0.001491       0.001289          01:49
              4       0.001718       0.003799          01:50
Better model found at epoch 5 with valid_loss value: 0.001249280832116566.
              5       0.001446       0.001249          01:49
Better model found at epoch 6 with valid_loss value: 0.0009484320051140256.
              6       0.001308       0.000948          01:49
              7       0.001069       0.001787          01:49
              8       0.001020       0.001178          01:49
              9       0.000900       0.002026          01:49
             10       0.000974       0.001346          01:49
             11       0.000831       0.001029          01:50
             12       0.000778       0.001371          01:49
             13       0.000802       0.001551          01:49
             14       0.000736       0.001406          01:50
             15       0.000720       0.001253          01:49
             16       0.000706       0.001474          01:49
             17       0.000685       0.001006          01:49
             18       0.000675       0.001207          01:50
             19       0.000674       0.001348          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.00043040550755574556, 'btl5': 0.2092123307903222, 'sharpe5': 0.8070556607634513, 'ndcg_score_top5': 0.9515120698666975}
----------- alpha: 2  itr: 5 Complete! Time:4012-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00011768119524349978
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.027141315596444265.
              0       0.050427       0.027141          00:43
Better model found at epoch 1 with valid_loss value: 0.01150331421503945.
              1       0.010763       0.011503          00:43
Better model found at epoch 2 with valid_loss value: 0.005921499596701728.
              2       0.005706       0.005921          00:44
Better model found at epoch 3 with valid_loss value: 0.004285015284069001.
              3       0.004198       0.004285          00:43
Better model found at epoch 4 with valid_loss value: 0.003458957113916912.
              4       0.003670       0.003459          00:43
Better model found at epoch 5 with valid_loss value: 0.0033219411732658506.
              5       0.003262       0.003322          00:44
Better model found at epoch 6 with valid_loss value: 0.002763893869188097.
              6       0.002994       0.002764          00:44
Better model found at epoch 7 with valid_loss value: 0.00265297411926209.
              7       0.002923       0.002653          00:44
              8       0.002811       0.002715          00:43
Better model found at epoch 9 with valid_loss value: 0.0025919628521752737.
              9       0.002769       0.002592          00:44
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0024361080593532985.
              0       0.002683       0.002436          01:50
Better model found at epoch 1 with valid_loss value: 0.0024099666920919267.
              1       0.002582       0.002410          01:50
Better model found at epoch 2 with valid_loss value: 0.0018511362492092073.
              2       0.002304       0.001851          01:50
Better model found at epoch 3 with valid_loss value: 0.0015841897517915756.
              3       0.002199       0.001584          01:49
              4       0.001876       0.002440          01:50
              5       0.001818       0.002217          01:50
              6       0.001551       0.001619          01:50
Better model found at epoch 7 with valid_loss value: 0.0013641097715922765.
              7       0.001402       0.001364          01:50
              8       0.001270       0.003315          01:49
              9       0.001214       0.002112          01:49
             10       0.001166       0.001473          01:50
Better model found at epoch 11 with valid_loss value: 0.0008727313270644536.
             11       0.001095       0.000873          01:50
             12       0.001037       0.002370          01:50
             13       0.001012       0.002581          01:50
             14       0.000975       0.002206          01:49
             15       0.000957       0.002247          01:49
             16       0.000929       0.001467          01:50
             17       0.000910       0.002205          01:49
             18       0.000911       0.001822          01:49
             19       0.000910       0.002210          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0004976559687201774, 'btl5': 0.4773302825161867, 'sharpe5': 1.6309274849434434, 'ndcg_score_top5': 0.9825156267225793}
----------- alpha: 2  itr: 6 Complete! Time:4014-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00011768119524349978
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.020709349995567686.
              0       0.036862       0.020709          00:43
Better model found at epoch 1 with valid_loss value: 0.008004255711086213.
              1       0.009194       0.008004          00:43
Better model found at epoch 2 with valid_loss value: 0.00458886462544638.
              2       0.004999       0.004589          00:43
Better model found at epoch 3 with valid_loss value: 0.003972365742637997.
              3       0.003839       0.003972          00:43
Better model found at epoch 4 with valid_loss value: 0.0028172721938481407.
              4       0.003428       0.002817          00:43
Better model found at epoch 5 with valid_loss value: 0.002533292013501364.
              5       0.003059       0.002533          00:43
Better model found at epoch 6 with valid_loss value: 0.0024434037151790803.
              6       0.002814       0.002443          00:43
Better model found at epoch 7 with valid_loss value: 0.0023392836252848306.
              7       0.002629       0.002339          00:43
Better model found at epoch 8 with valid_loss value: 0.0023148078767080155.
              8       0.002534       0.002315          00:43
              9       0.002522       0.002372          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0022639830907185874.
              0       0.002530       0.002264          01:50
Better model found at epoch 1 with valid_loss value: 0.002135372587612697.
              1       0.002374       0.002135          01:49
              2       0.002116       0.004322          01:50
Better model found at epoch 3 with valid_loss value: 0.0020265054135095504.
              3       0.002060       0.002027          01:49
Better model found at epoch 4 with valid_loss value: 0.0012545470917035664.
              4       0.001774       0.001255          01:50
              5       0.001638       0.001428          01:50
              6       0.001492       0.002636          01:49
              7       0.001377       0.001769          01:50
              8       0.001222       0.003828          01:50
              9       0.001162       0.001549          01:50
             10       0.001077       0.001968          01:50
             11       0.001062       0.001549          01:50
             12       0.000991       0.001900          01:50
             13       0.000960       0.001451          01:50
             14       0.000925       0.001735          01:49
             15       0.000898       0.001928          01:50
             16       0.000887       0.001672          01:50
             17       0.000865       0.001765          01:50
             18       0.000862       0.001563          01:50
             19       0.000853       0.001642          01:50
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0005886559370497659, 'btl5': 0.47758702784888496, 'sharpe5': 1.7161128289463023, 'ndcg_score_top5': 0.9888953261798623}
----------- alpha: 2  itr: 7 Complete! Time:4013-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00017073526474706903
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.025253449167524065.
              0       0.045238       0.025253          00:43
Better model found at epoch 1 with valid_loss value: 0.007428051933409676.
              1       0.008882       0.007428          00:43
Better model found at epoch 2 with valid_loss value: 0.003424245450231764.
              2       0.004637       0.003424          00:44
              3       0.003604       0.003918          00:43
Better model found at epoch 4 with valid_loss value: 0.0026372051428234767.
              4       0.003162       0.002637          00:43
Better model found at epoch 5 with valid_loss value: 0.0022323339704483276.
              5       0.003011       0.002232          00:43
              6       0.002664       0.002487          00:43
              7       0.002579       0.002522          00:43
Better model found at epoch 8 with valid_loss value: 0.002045436037911309.
              8       0.002458       0.002045          00:43
Better model found at epoch 9 with valid_loss value: 0.002026920517285665.
              9       0.002427       0.002027          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0019222434077944075.
              0       0.002348       0.001922          01:50
Better model found at epoch 1 with valid_loss value: 0.0018549147579405042.
              1       0.002211       0.001855          01:50
Better model found at epoch 2 with valid_loss value: 0.001797718069856129.
              2       0.002009       0.001798          01:50
              3       0.001973       0.002229          01:50
Better model found at epoch 4 with valid_loss value: 0.0011640628651967124.
              4       0.001643       0.001164          01:50
Better model found at epoch 5 with valid_loss value: 0.0011339689057970803.
              5       0.001564       0.001134          01:50
              6       0.001422       0.002359          01:50
Better model found at epoch 7 with valid_loss value: 0.000915260955927864.
              7       0.001227       0.000915          01:50
Better model found at epoch 8 with valid_loss value: 0.0008201979928546482.
              8       0.001102       0.000820          01:50
              9       0.001000       0.001088          01:50
             10       0.001036       0.000963          01:50
             11       0.000950       0.000879          01:49
             12       0.000891       0.001262          01:50
             13       0.000861       0.000915          01:50
             14       0.000827       0.001295          01:50
             15       0.000804       0.001261          01:50
             16       0.000792       0.001196          01:49
             17       0.000777       0.001068          01:49
             18       0.000774       0.001024          01:50
             19       0.000771       0.001088          01:50
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0004447862150728772, 'btl5': 0.014055666735554695, 'sharpe5': 0.19877781152867696, 'ndcg_score_top5': 0.9561045221691645}
----------- alpha: 2  itr: 8 Complete! Time:4015-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00017073526474706903
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.01515632394760374.
              0       0.028782       0.015156          00:43
Better model found at epoch 1 with valid_loss value: 0.006212380197313096.
              1       0.007118       0.006212          00:43
Better model found at epoch 2 with valid_loss value: 0.004278396330182514.
              2       0.004112       0.004278          00:44
Better model found at epoch 3 with valid_loss value: 0.0036182308953905864.
              3       0.003483       0.003618          00:43
Better model found at epoch 4 with valid_loss value: 0.0028251662613853574.
              4       0.003270       0.002825          00:43
Better model found at epoch 5 with valid_loss value: 0.0026296438678862556.
              5       0.002785       0.002630          00:43
Better model found at epoch 6 with valid_loss value: 0.0023028644777479627.
              6       0.002579       0.002303          00:43
              7       0.002399       0.002373          00:43
Better model found at epoch 8 with valid_loss value: 0.0021415057163389904.
              8       0.002255       0.002142          00:43
              9       0.002216       0.002365          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0019842199389896696.
              0       0.002128       0.001984          01:50
Better model found at epoch 1 with valid_loss value: 0.0015702357604390098.
              1       0.002032       0.001570          01:50
Better model found at epoch 2 with valid_loss value: 0.0014541428240518722.
              2       0.002008       0.001454          01:50
              3       0.001822       0.005337          01:50
              4       0.001626       0.001475          01:50
Better model found at epoch 5 with valid_loss value: 0.0010192740767721146.
              5       0.001469       0.001019          01:50
              6       0.001243       0.002605          01:50
              7       0.001173       0.004147          01:50
              8       0.001255       0.002012          01:50
Better model found at epoch 9 with valid_loss value: 0.0008660817430132912.
              9       0.001004       0.000866          01:50
             10       0.000941       0.001591          01:50
             11       0.000901       0.001401          01:50
Better model found at epoch 12 with valid_loss value: 0.0008324981918410649.
             12       0.000851       0.000832          01:50
             13       0.000816       0.000946          01:50
             14       0.000836       0.001012          01:50
             15       0.000802       0.001068          01:50
             16       0.000769       0.001158          01:50
             17       0.000745       0.001139          01:49
             18       0.000739       0.001076          01:50
             19       0.000738       0.001140          01:50
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0003948632700722716, 'btl5': 0.19719484691399414, 'sharpe5': 0.9301099543279593, 'ndcg_score_top5': 0.9094001852107897}
----------- alpha: 2  itr: 9 Complete! Time:4016-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00017073526474706903
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.016202078925238714.
              0       0.023739       0.016202          00:43
Better model found at epoch 1 with valid_loss value: 0.0063531190629989385.
              1       0.007511       0.006353          00:43
Better model found at epoch 2 with valid_loss value: 0.003645397840984284.
              2       0.004466       0.003645          00:44
Better model found at epoch 3 with valid_loss value: 0.002756821257727487.
              3       0.003787       0.002757          00:43
Better model found at epoch 4 with valid_loss value: 0.002558855310318962.
              4       0.002976       0.002559          00:44
Better model found at epoch 5 with valid_loss value: 0.002217761817432585.
              5       0.002956       0.002218          00:44
              6       0.002447       0.002973          00:44
Better model found at epoch 7 with valid_loss value: 0.002042204851195926.
              7       0.002272       0.002042          00:44
Better model found at epoch 8 with valid_loss value: 0.0019342569368226187.
              8       0.002158       0.001934          00:44
              9       0.002072       0.001987          00:44
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.001845281275491866.
              0       0.002095       0.001845          01:50
              1       0.001993       0.002142          01:49
Better model found at epoch 2 with valid_loss value: 0.0014709971017307704.
              2       0.001886       0.001471          01:49
Better model found at epoch 3 with valid_loss value: 0.0012746575096296885.
              3       0.001667       0.001275          01:50
              4       0.001637       0.001505          01:50
              5       0.001499       0.001739          01:50
              6       0.001229       0.001423          01:49
Better model found at epoch 7 with valid_loss value: 0.0009165872775373005.
              7       0.001205       0.000917          01:50
              8       0.001040       0.000989          01:50
              9       0.000987       0.000930          01:50
             10       0.000977       0.001433          01:50
             11       0.000911       0.001220          01:50
             12       0.000855       0.001229          01:50
             13       0.000812       0.000958          01:50
             14       0.000790       0.001255          01:50
             15       0.000766       0.001508          01:50
             16       0.000758       0.000990          01:50
             17       0.000738       0.001235          01:50
             18       0.000727       0.001474          01:50
             19       0.000724       0.001357          01:50
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0004649620133129721, 'btl5': 0.12942747318335068, 'sharpe5': 0.6038021362164193, 'ndcg_score_top5': 0.9813827567857546}
----------- alpha: 2  itr: 10 Complete! Time:4016-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00035938136638046257
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.00984839882169451.
              0       0.021104       0.009848          00:43
Better model found at epoch 1 with valid_loss value: 0.005215417298059615.
              1       0.005611       0.005215          00:43
Better model found at epoch 2 with valid_loss value: 0.004843180614804465.
              2       0.004371       0.004843          00:44
Better model found at epoch 3 with valid_loss value: 0.003191034472177899.
              3       0.004095       0.003191          00:43
              4       0.006202       0.004867          00:43
              5       0.003129       0.007810          00:43
Better model found at epoch 6 with valid_loss value: 0.0022259226867130826.
              6       0.003789       0.002226          00:43
              7       0.002003       0.002811          00:43
Better model found at epoch 8 with valid_loss value: 0.0017561022014844986.
              8       0.001827       0.001756          00:43
              9       0.001769       0.001808          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0016461944296246483.
              0       0.001749       0.001646          01:50
Better model found at epoch 1 with valid_loss value: 0.0014605377874677143.
              1       0.001567       0.001461          01:50
              2       0.001608       0.003950          01:50
              3       0.001474       0.003108          01:50
Better model found at epoch 4 with valid_loss value: 0.001170820068745386.
              4       0.001434       0.001171          01:50
Better model found at epoch 5 with valid_loss value: 0.0010676770692779904.
              5       0.001356       0.001068          01:50
              6       0.001179       0.001139          01:50
Better model found at epoch 7 with valid_loss value: 0.0010190036088701278.
              7       0.001065       0.001019          01:50
Better model found at epoch 8 with valid_loss value: 0.0008799589815593901.
              8       0.001017       0.000880          01:50
Better model found at epoch 9 with valid_loss value: 0.0007959140671624078.
              9       0.000878       0.000796          01:50
             10       0.000811       0.000927          01:50
             11       0.000777       0.001423          01:50
             12       0.000723       0.000857          01:50
             13       0.000681       0.000876          01:50
             14       0.000659       0.001098          01:50
             15       0.000623       0.000898          01:50
             16       0.000612       0.000920          01:50
             17       0.000601       0.000869          01:50
             18       0.000585       0.000870          01:50
             19       0.000585       0.000832          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0004030738733577257, 'btl5': 0.46069332081258807, 'sharpe5': 1.6297191110086666, 'ndcg_score_top5': 0.9976754105531955}
----------- alpha: 2  itr: 11 Complete! Time:4018-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00014174741629268049
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.01756904995630658.
              0       0.033742       0.017569          00:43
Better model found at epoch 1 with valid_loss value: 0.007734574968852694.
              1       0.007972       0.007735          00:44
Better model found at epoch 2 with valid_loss value: 0.003153883512057955.
              2       0.004319       0.003154          00:44
              3       0.003446       0.004253          00:43
Better model found at epoch 4 with valid_loss value: 0.0024277977054081266.
              4       0.003235       0.002428          00:43
              5       0.003118       0.003515          00:43
Better model found at epoch 6 with valid_loss value: 0.0020507661596177117.
              6       0.002647       0.002051          00:43
              7       0.002364       0.002173          00:44
Better model found at epoch 8 with valid_loss value: 0.0018541234589758374.
              8       0.002351       0.001854          00:43
              9       0.002296       0.001877          00:44
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0017156012001491728.
              0       0.002232       0.001716          01:50
Better model found at epoch 1 with valid_loss value: 0.0015392118976229714.
              1       0.002082       0.001539          01:50
Better model found at epoch 2 with valid_loss value: 0.0014295087210715763.
              2       0.001910       0.001430          01:50
              3       0.001749       0.001536          01:50
Better model found at epoch 4 with valid_loss value: 0.0012504537663762532.
              4       0.001603       0.001250          01:50
              5       0.001524       0.002222          01:50
              6       0.001347       0.002552          01:50
              7       0.001302       0.002267          01:50
              8       0.001127       0.001501          01:50
              9       0.001024       0.002035          01:50
             10       0.001015       0.001982          01:50
             11       0.000935       0.001540          01:50
             12       0.000896       0.001725          01:50
             13       0.000870       0.002388          01:50
             14       0.000842       0.001377          01:50
             15       0.000822       0.001597          01:50
             16       0.000791       0.001366          01:50
             17       0.000786       0.001537          01:50
             18       0.000779       0.001283          01:50
             19       0.000767       0.001510          01:50
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0005941482375106482, 'btl5': 0.17390925134197532, 'sharpe5': 0.7640642183298291, 'ndcg_score_top5': 0.9849917998414712}
----------- alpha: 2  itr: 12 Complete! Time:4019-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.0010974987654930567
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.013039576628851511.
              0       0.011506       0.013040          00:43
              1       0.020955       0.081462          00:43
              2       0.041105       0.013785          00:44
              3       0.012355       0.013256          00:43
Better model found at epoch 4 with valid_loss value: 0.0059086476999615865.
              4       0.026959       0.005909          00:43
              5       0.007291       0.006778          00:43
Better model found at epoch 6 with valid_loss value: 0.002616762641876463.
              6       0.003652       0.002617          00:43
Better model found at epoch 7 with valid_loss value: 0.0019792039243001786.
              7       0.002434       0.001979          00:43
Better model found at epoch 8 with valid_loss value: 0.0018855720048859006.
              8       0.002209       0.001886          00:43
              9       0.002147       0.002104          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0013257359701489646.
              0       0.002031       0.001326          01:50
              1       0.001770       0.001426          01:50
Better model found at epoch 2 with valid_loss value: 0.00129282959396877.
              2       0.001899       0.001293          01:50
              3       0.001908       0.001639          01:49
              4       0.001322       0.001501          01:50
Better model found at epoch 5 with valid_loss value: 0.0008040985890797206.
              5       0.001328       0.000804          01:50
              6       0.001272       0.001214          01:50
              7       0.000919       0.001409          01:50
              8       0.001258       0.001751          01:50
Better model found at epoch 9 with valid_loss value: 0.0007742562937358069.
              9       0.000879       0.000774          01:50
             10       0.000911       0.001481          01:50
Better model found at epoch 11 with valid_loss value: 0.0007733004906820873.
             11       0.000731       0.000773          01:49
             12       0.000699       0.000844          01:50
             13       0.000643       0.000923          01:50
Better model found at epoch 14 with valid_loss value: 0.0006901673854343475.
             14       0.000631       0.000690          01:50
             15       0.000603       0.000692          01:50
             16       0.000576       0.000713          01:50
             17       0.000548       0.000791          01:49
             18       0.000537       0.000767          01:50
Better model found at epoch 19 with valid_loss value: 0.0006900962501291245.
             19       0.000535       0.000690          01:50
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0003188143128692723, 'btl5': 0.15626597732655223, 'sharpe5': 0.6568872002902786, 'ndcg_score_top5': 0.9840568315881447}
----------- alpha: 2  itr: 13 Complete! Time:4018-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.0002477076355991711
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.01682255570850675.
              0       0.032562       0.016823          00:43
Better model found at epoch 1 with valid_loss value: 0.00807864609218779.
              1       0.006895       0.008079          00:44
Better model found at epoch 2 with valid_loss value: 0.006424850887722439.
              2       0.004069       0.006425          00:44
Better model found at epoch 3 with valid_loss value: 0.002903429288712759.
              3       0.003282       0.002903          00:43
              4       0.005366       0.004285          00:43
              5       0.002919       0.003785          00:44
Better model found at epoch 6 with valid_loss value: 0.0019125024241114419.
              6       0.002408       0.001913          00:43
              7       0.002193       0.003505          00:43
Better model found at epoch 8 with valid_loss value: 0.0019019030862384373.
              8       0.002128       0.001902          00:44
              9       0.002050       0.001919          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
              0       0.001957       0.002099          01:50
Better model found at epoch 1 with valid_loss value: 0.0015483925503397744.
              1       0.001829       0.001548          01:50
Better model found at epoch 2 with valid_loss value: 0.0011965956479784042.
              2       0.001701       0.001197          01:50
              3       0.001682       0.001322          01:50
              4       0.001472       0.001578          01:50
Better model found at epoch 5 with valid_loss value: 0.0010539921266692026.
              5       0.001509       0.001054          01:50
              6       0.001170       0.002620          01:50
              7       0.001153       0.002993          01:50
Better model found at epoch 8 with valid_loss value: 0.0008929142994540078.
              8       0.001018       0.000893          01:50
              9       0.001183       0.001771          01:50
             10       0.000896       0.000950          01:50
             11       0.000887       0.001403          01:50
             12       0.000845       0.001193          01:50
             13       0.000746       0.001267          01:50
             14       0.000752       0.001549          01:50
             15       0.000728       0.001206          01:50
             16       0.000697       0.001111          01:50
             17       0.000683       0.001113          01:49
             18       0.000676       0.000976          01:49
             19       0.000662       0.000998          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0004309416702155516, 'btl5': 0.40157586879518914, 'sharpe5': 1.5690742718266475, 'ndcg_score_top5': 0.9135658490916982}
----------- alpha: 2  itr: 14 Complete! Time:4020-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.0005214008287999684
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.00987325868909321.
              0       0.016202       0.009873          00:43
Better model found at epoch 1 with valid_loss value: 0.0033956338015813676.
              1       0.004466       0.003396          00:43
              2       0.016763       0.021106          00:43
              3       0.021238       0.005731          00:43
              4       0.003403       0.008672          00:43
              5       0.004719       0.004741          00:43
Better model found at epoch 6 with valid_loss value: 0.0021866640401264977.
              6       0.002342       0.002187          00:43
Better model found at epoch 7 with valid_loss value: 0.0019233164096635485.
              7       0.002086       0.001923          00:43
Better model found at epoch 8 with valid_loss value: 0.0018874646888838874.
              8       0.001950       0.001887          00:43
              9       0.001874       0.001890          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.00147673428531677.
              0       0.001778       0.001477          01:50
Better model found at epoch 1 with valid_loss value: 0.0012519497956548417.
              1       0.001607       0.001252          01:49
              2       0.001632       0.004279          01:49
              3       0.001586       0.001585          01:49
              4       0.001629       0.001283          01:49
              5       0.001306       0.002421          01:49
              6       0.001295       0.001511          01:49
Better model found at epoch 7 with valid_loss value: 0.0007678074614396171.
              7       0.001023       0.000768          01:49
              8       0.000890       0.000808          01:49
              9       0.000854       0.000836          01:49
Better model found at epoch 10 with valid_loss value: 0.0007314122030659327.
             10       0.000807       0.000731          01:49
Better model found at epoch 11 with valid_loss value: 0.0006869460736948347.
             11       0.000732       0.000687          01:49
             12       0.000706       0.000909          01:49
             13       0.000665       0.000753          01:49
             14       0.000634       0.000756          01:49
             15       0.000607       0.000717          01:49
             16       0.000596       0.000952          01:49
             17       0.000573       0.000712          01:49
             18       0.000563       0.000691          01:49
Better model found at epoch 19 with valid_loss value: 0.0006860948744274321.
             19       0.000553       0.000686          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0003027441201808016, 'btl5': 0.6026039089572535, 'sharpe5': 1.7891674880080441, 'ndcg_score_top5': 0.9719834832708023}
----------- alpha: 2  itr: 15 Complete! Time:4010-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 9.770099572992256e-05
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.023223086008949886.
              0       0.030075       0.023223          00:43
Better model found at epoch 1 with valid_loss value: 0.011630829364534408.
              1       0.009340       0.011631          00:43
Better model found at epoch 2 with valid_loss value: 0.00477453072865804.
              2       0.005142       0.004775          00:43
Better model found at epoch 3 with valid_loss value: 0.003146583125704811.
              3       0.003917       0.003147          00:43
              4       0.003550       0.003285          00:43
Better model found at epoch 5 with valid_loss value: 0.0026678241907604158.
              5       0.003159       0.002668          00:43
Better model found at epoch 6 with valid_loss value: 0.0025514191578304957.
              6       0.002842       0.002551          00:43
              7       0.002780       0.002756          00:43
Better model found at epoch 8 with valid_loss value: 0.00220846018147847.
              8       0.002724       0.002208          00:43
              9       0.002679       0.002296          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
              0       0.002622       0.002278          01:49
Better model found at epoch 1 with valid_loss value: 0.0017450437659309024.
              1       0.002480       0.001745          01:49
Better model found at epoch 2 with valid_loss value: 0.001494576060582721.
              2       0.002334       0.001495          01:49
Better model found at epoch 3 with valid_loss value: 0.0013782477804592677.
              3       0.002051       0.001378          01:49
              4       0.001860       0.001749          01:49
Better model found at epoch 5 with valid_loss value: 0.0011674596203698053.
              5       0.001889       0.001167          01:49
              6       0.001530       0.001234          01:49
              7       0.001422       0.001207          01:49
              8       0.001282       0.001377          01:49
              9       0.001245       0.002257          01:49
             10       0.001208       0.001778          01:49
             11       0.001134       0.001303          01:49
             12       0.001052       0.001781          01:49
             13       0.001014       0.001838          01:49
             14       0.001000       0.001436          01:49
             15       0.000974       0.002027          01:49
             16       0.000956       0.001198          01:49
             17       0.000942       0.001458          01:49
             18       0.000930       0.001298          01:49
             19       0.000921       0.001314          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0006646515461799904, 'btl5': 0.2422922384422903, 'sharpe5': 0.9327563081760063, 'ndcg_score_top5': 0.994032458081813}
----------- alpha: 2  itr: 16 Complete! Time:4009-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00011768119524349978
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.02196425294119214.
              0       0.032405       0.021964          00:43
Better model found at epoch 1 with valid_loss value: 0.007865542457217262.
              1       0.009467       0.007866          00:43
Better model found at epoch 2 with valid_loss value: 0.006702614682061332.
              2       0.005061       0.006703          00:43
Better model found at epoch 3 with valid_loss value: 0.003179700365142217.
              3       0.003822       0.003180          00:43
Better model found at epoch 4 with valid_loss value: 0.00256344959849403.
              4       0.003331       0.002563          00:43
              5       0.003174       0.003132          00:43
Better model found at epoch 6 with valid_loss value: 0.0023937199323896376.
              6       0.002791       0.002394          00:43
Better model found at epoch 7 with valid_loss value: 0.0023679430522615947.
              7       0.002663       0.002368          00:43
Better model found at epoch 8 with valid_loss value: 0.0022330042861756823.
              8       0.002533       0.002233          00:43
              9       0.002518       0.002264          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0020717309107856144.
              0       0.002489       0.002072          01:49
Better model found at epoch 1 with valid_loss value: 0.0018106585457211449.
              1       0.002298       0.001811          01:49
Better model found at epoch 2 with valid_loss value: 0.001648056483457959.
              2       0.002142       0.001648          01:49
Better model found at epoch 3 with valid_loss value: 0.0014076648013932364.
              3       0.001918       0.001408          01:49
              4       0.001699       0.001822          01:49
              5       0.001570       0.002635          01:49
Better model found at epoch 6 with valid_loss value: 0.0013310074333160642.
              6       0.001450       0.001331          01:49
              7       0.001315       0.004821          01:49
              8       0.001261       0.001406          01:49
Better model found at epoch 9 with valid_loss value: 0.0012684399409899636.
              9       0.001140       0.001268          01:49
             10       0.001077       0.001364          01:49
             11       0.001039       0.001837          01:49
             12       0.000970       0.001928          01:49
             13       0.000946       0.001685          01:49
             14       0.000921       0.001644          01:49
Better model found at epoch 15 with valid_loss value: 0.0012539299944090464.
             15       0.000887       0.001254          01:49
             16       0.000866       0.001352          01:49
             17       0.000853       0.001696          01:49
             18       0.000851       0.001599          01:49
             19       0.000844       0.001406          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.000446063068467575, 'btl5': 0.21713590543646677, 'sharpe5': 1.0719618226156442, 'ndcg_score_top5': 0.9552178504355401}
----------- alpha: 2  itr: 17 Complete! Time:4005-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.0009111627561154895
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.006767527924643623.
              0       0.019133       0.006768          00:43
              1       0.006356       0.016154          00:43
              2       0.055398       0.218477          00:43
Better model found at epoch 3 with valid_loss value: 0.00483705789323837.
              3       0.012233       0.004837          00:43
              4       0.007599       0.008890          00:43
              5       0.004162       0.012867          00:43
Better model found at epoch 6 with valid_loss value: 0.0029286775324079725.
              6       0.003578       0.002929          00:43
Better model found at epoch 7 with valid_loss value: 0.0019589222612835114.
              7       0.002278       0.001959          00:43
              8       0.001993       0.002087          00:43
Better model found at epoch 9 with valid_loss value: 0.0019245471746202499.
              9       0.001899       0.001925          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.001779517602352869.
              0       0.001839       0.001780          01:50
              1       0.001793       0.005426          01:49
              2       0.001736       0.002219          01:49
              3       0.001940       0.002893          01:50
Better model found at epoch 4 with valid_loss value: 0.0010534621893413484.
              4       0.001715       0.001053          01:49
              5       0.001147       0.001612          01:49
Better model found at epoch 6 with valid_loss value: 0.001043800323728531.
              6       0.001064       0.001044          01:49
              7       0.001466       0.001224          01:49
Better model found at epoch 8 with valid_loss value: 0.0008926854010612245.
              8       0.000782       0.000893          01:49
              9       0.000849       0.000930          01:49
Better model found at epoch 10 with valid_loss value: 0.0008757569132343172.
             10       0.000746       0.000876          01:49
Better model found at epoch 11 with valid_loss value: 0.0006549750410375141.
             11       0.000709       0.000655          01:49
             12       0.000780       0.000709          01:49
             13       0.000663       0.000933          01:49
             14       0.000613       0.000925          01:49
             15       0.000601       0.000708          01:49
             16       0.000574       0.000821          01:49
             17       0.000547       0.000776          01:49
             18       0.000543       0.000748          01:49
             19       0.000529       0.000740          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.0002903217069586898, 'btl5': 0.3160204920728744, 'sharpe5': 1.1480729308751851, 'ndcg_score_top5': 0.8952531813973357}
----------- alpha: 2  itr: 18 Complete! Time:4011-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.00035938136638046257
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.01116717050945948.
              0       0.027889       0.011167          00:43
Better model found at epoch 1 with valid_loss value: 0.004055480635355389.
              1       0.005654       0.004055          00:43
              2       0.004340       0.010428          00:43
              3       0.011315       0.226908          00:43
              4       0.008191       0.009917          00:43
Better model found at epoch 5 with valid_loss value: 0.0025659827958969842.
              5       0.004563       0.002566          00:43
Better model found at epoch 6 with valid_loss value: 0.0020936114920510184.
              6       0.002429       0.002094          00:43
Better model found at epoch 7 with valid_loss value: 0.0018851542993197365.
              7       0.002210       0.001885          00:43
Better model found at epoch 8 with valid_loss value: 0.0016441308553256685.
              8       0.001981       0.001644          00:43
              9       0.001952       0.001739          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.0015020051172801427.
              0       0.001893       0.001502          01:50
Better model found at epoch 1 with valid_loss value: 0.001121904050546979.
              1       0.001753       0.001122          01:50
              2       0.001730       0.002835          01:49
              3       0.001695       0.001992          01:49
              4       0.001794       0.006668          01:49
              5       0.001640       0.001217          01:50
              6       0.001203       0.002168          01:50
              7       0.001006       0.001870          01:49
              8       0.000993       0.001486          01:49
              9       0.000900       0.001820          01:49
Better model found at epoch 10 with valid_loss value: 0.0008457541347496094.
             10       0.000816       0.000846          01:49
             11       0.000796       0.000851          01:49
Better model found at epoch 12 with valid_loss value: 0.000824207706110818.
             12       0.000764       0.000824          01:49
Better model found at epoch 13 with valid_loss value: 0.0008167120081091684.
             13       0.000721       0.000817          01:49
             14       0.000691       0.000832          01:49
             15       0.000665       0.000872          01:49
Better model found at epoch 16 with valid_loss value: 0.0008094882562993065.
             16       0.000646       0.000809          01:49
             17       0.000632       0.000928          01:49
             18       0.000622       0.000847          01:49
             19       0.000609       0.000850          01:49
finetune completed
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
self.results shape: (1737, 237)
self.preds shape: (1737, 237)
self.trues shape: (1737, 237)
self.masks shape: (1737, 237)
Test preformance: {'mse': 0.00036272648134883087, 'btl5': 0.5666552582104261, 'sharpe5': 2.1414234830298127, 'ndcg_score_top5': 0.8361222091439812}
----------- alpha: 2  itr: 19 Complete! Time:4011-----------
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

suggested_lr 0.000298364724028334
end-to-end finetuning
#datautilis tickers_fname: NYSE_tickers_qualify_dr-0.98_min-5_smooth.csv
#tickers selected: 1737
#single EOD data shape: (756, 5)
#eod_data shape: (1737, 756, 5)
#masks shape: (1737, 756)
#ground_truth shape: (1737, 756)
#base_price shape: (1737, 756)
#data_stamp shape: (1737, 756, 4)
#tickers selected: 1737
#single EOD data shape: (764, 5)
#eod_data shape: (1737, 764, 5)
#masks shape: (1737, 764)
#ground_truth shape: (1737, 764)
#base_price shape: (1737, 764)
#data_stamp shape: (1737, 764, 4)
#tickers selected: 1737
#single EOD data shape: (749, 5)
#eod_data shape: (1737, 749, 5)
#masks shape: (1737, 749)
#ground_truth shape: (1737, 749)
#base_price shape: (1737, 749)
#data_stamp shape: (1737, 749, 4)
number of patches: 42
number of model params 1876097
weights from /home/adam/MSMS-CI-STHPAN/CI-STHPAN_self_supervised/saved_models/NYSE/pretrained/patchtst_pretrained_cw512_patch12_stride12_epochs-pretrain100_mask0.4_revin1_ci1_graph1_rel_type8_k20/model0/model.pth successfully transferred!

Finetune the head
          epoch     train_loss     valid_loss           time
Better model found at epoch 0 with valid_loss value: 0.015758512512085928.
              0       0.022162       0.015759          00:43
Better model found at epoch 1 with valid_loss value: 0.00535686006621709.
              1       0.006172       0.005357          00:43
Better model found at epoch 2 with valid_loss value: 0.003678761777423677.
              2       0.004242       0.003679          00:43
              3       0.004371       0.004006          00:43
Better model found at epoch 4 with valid_loss value: 0.0028428693139363847.
              4       0.005160       0.002843          00:43
              5       0.002802       0.004128          00:43
Better model found at epoch 6 with valid_loss value: 0.0019271465994062879.
              6       0.002456       0.001927          00:43
              7       0.002012       0.002003          00:43
Better model found at epoch 8 with valid_loss value: 0.0017878801103622195.
              8       0.001900       0.001788          00:43
              9       0.001885       0.001840          00:43
Finetune the entire network
          epoch     train_loss     valid_loss           time
              0       0.001805       0.001931          01:50
              1       0.001739       0.001956          01:50
Better model found at epoch 2 with valid_loss value: 0.0015917826029989454.
              2       0.001629       0.001592          01:50
              3       0.001527       0.002655          01:50
              4       0.001918       0.004949          01:49
Better model found at epoch 5 with valid_loss value: 0.0011295955332498702.
              5       0.001192       0.001130          01:50
              6       0.001270       0.001237          01:50
              7       0.001156       0.003855          01:50
              8       0.001049       0.001361          01:50
Better model found at epoch 9 with valid_loss value: 0.0009056408963506184.
              9       0.000894       0.000906          01:50
             10       0.000857       0.000988          01:50
             11       0.000774       0.001252          01:49
             12       0.000782       0.001377          01:49
